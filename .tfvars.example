# DigitalOcean API Token (required)
# Get your token from: https://cloud.digitalocean.com/account/api/tokens
do_token = "your-digitalocean-api-token-here"

# Database cluster configuration
cluster_name    = "tommaso-cluster"
postgres_version = "16"
db_size         = "db-s-1vcpu-1gb"
region          = "nyc1"
node_count      = 1

# Database user
# Note: DigitalOcean automatically creates 'defaultdb' database and 'doadmin' user
# You can create additional users if needed
database_user = "doadmin"

# Tags for resource organization
tags = ["production", "postgres"]

# Maintenance window
maintenance_day  = "sunday"
maintenance_hour = "02"

# Firewall rules - allow connections from specific IPs or droplet tags
# Example: Allow from a specific IP
# allowed_sources = [
#   {
#     type  = "ip_addr"
#     value = "192.168.1.1"
#   }
# ]

# Example: Allow from all droplets with a specific tag
# allowed_sources = [
#   {
#     type  = "tag"
#     value = "web-servers"
#   }
# ]

allowed_sources = []

# Valkey (Redis-compatible) Database Configuration
valkey_cluster_name = "valkey-cluster"
valkey_version      = "8"
valkey_size         = "db-s-1vcpu-1gb"
valkey_region       = "nyc1"
valkey_node_count   = 1
valkey_user         = "doadmin"

# Tags for Valkey cluster
valkey_tags = ["production", "valkey", "redis"]

# Firewall rules for Valkey - allow connections from specific IPs or droplet tags
# Example: Allow from a specific IP
# valkey_allowed_sources = [
#   {
#     type  = "ip_addr"
#     value = "192.168.1.1"
#   }
# ]

# Example: Allow from all droplets with a specific tag
# valkey_allowed_sources = [
#   {
#     type  = "tag"
#     value = "web-servers"
#   }
# ]

valkey_allowed_sources = []

# Main Droplet Configuration
main_name   = "n8n-main"
main_size   = "s-1vcpu-2gb"
# Docker marketplace image with Docker & Docker Compose pre-installed
# Alternatives: "ubuntu-22-04-x64", "ubuntu-24-04-x64"
main_image  = "docker-20-04"
main_region = "nyc1"
main_tags   = ["n8n", "main", "production"]

# n8n Configuration
n8n_timezone = "America/New_York"  # Options: UTC, America/New_York, Europe/London, Asia/Tokyo, etc.

# Encryption Key (optional - will be auto-generated if not provided)
# IMPORTANT: All n8n instances (main + workers) MUST use the same encryption key
# If you set this manually, ensure it's exactly 32 hexadecimal characters (0-9, a-f)
# Example: n8n_encryption_key = "a1b2c3d4e5f6789012345678901234ab"
# Leave empty to auto-generate (recommended)
n8n_encryption_key = ""

# Load Balancer and DNS Configuration (Optional)
# Leave domain_name empty to skip load balancer and DNS setup
domain_name = ""  # e.g., "n8n.example.com"

# Load Balancer Settings
load_balancer_name   = "n8n-lb"
load_balancer_size   = "lb-small"  # Options: lb-small ($12/mo), lb-medium ($24/mo), lb-large ($48/mo)
load_balancer_region = "nyc1"      # Should match main_region

# SSL Certificate
# Leave empty to auto-create Let's Encrypt certificate
# Or provide name of existing DigitalOcean certificate
ssl_certificate_name = ""

# DNS Configuration
# Base domain for DNS (e.g., "example.com")
# If not provided, will be extracted from domain_name
# Required if domain_name is a subdomain like "n8n.example.com"
dns_domain = ""  # e.g., "example.com"

# Whether to create DNS A record pointing to load balancer
create_dns_record = true

# Optional: Cloud-init user data script for main instance initialization
# If left empty, will automatically use main-init.sh which:
#   - Sets EXECUTIONS_MODE=queue
#   - Starts n8n with Docker connected to PostgreSQL and Valkey
#   - Configures n8n for queue mode with horizontal scaling
# Example custom script:
# main_user_data = <<-EOF
#   #!/bin/bash
#   apt-get update
#   apt-get install -y docker.io nginx
#   systemctl start docker
#   systemctl enable docker
#   export EXECUTIONS_MODE=queue
# EOF
main_user_data = ""

# Worker Droplets Configuration
worker_count       = 3
worker_name_prefix = "n8n-worker"
worker_size        = "s-1vcpu-1gb"
# Docker marketplace image with Docker & Docker Compose pre-installed
# Alternatives: "ubuntu-22-04-x64", "ubuntu-24-04-x64"
worker_image       = "docker-20-04"
worker_region      = "nyc1"
worker_tags        = ["n8n", "worker", "production"]

# SSH Keys - IMPORTANT: Add your SSH key IDs or fingerprints
# Get your SSH keys from: https://cloud.digitalocean.com/account/security
# Example: ssh_keys = ["12:34:56:78:90:ab:cd:ef", "aa:bb:cc:dd:ee:ff"]
ssh_keys = []

# Optional: Cloud-init user data script for worker initialization
# If left empty, will automatically use worker-init.sh (sets EXECUTIONS_MODE=queue)
# This script will run on first boot of each worker
# Example custom script:
# worker_user_data = <<-EOF
#   #!/bin/bash
#   apt-get update
#   apt-get install -y docker.io
#   systemctl start docker
#   systemctl enable docker
#   export EXECUTIONS_MODE=queue
# EOF
worker_user_data = ""
